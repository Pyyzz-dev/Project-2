<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teacher</title>
    <script src="/javascripts/jquery/jquery/jquery-3.5.1.min.js"></script>
    <link rel="stylesheet" href="/javascripts/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="/stylesheets/styleTeacher.css">
</head>

<body>  
    <div class="container d-flex">
        <div  class="row">
            <div class="col-8">
                <div class="container-fluid px-0 py-5">
                    <table class="table table-hover">
                        <thead>
                            <tr style="color: white;">
                                <th>Số thứ tự</th>
                                <th>Username</th>
                                <th>Role</th>
                                <th>
                                    <div class="just-role">
                                        Fix
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <% for(var i = 0 ; i < data.length; i++){ %>
                            <% var id = i + 1%>
                            <tr>
                                <th style="color: white;" scope="row"><%= id%></th>
                                <div>
                                    <td style="color: white;" class="info-teacher-<%= data[i]._id%>"><%= data[i].username%></td>
                                    <td class="general info-teacher-input-<%= data[i]._id%>"><input type="text" value="" id="update-info-teacher-<%= data[i]._id%>"></td>
                                </div>
                                <td style="color: white;">Sếp phó</td>
                                <td>
                                    <button style="color: white;" type="button" onclick="clickUpdate(`<%= data[i]._id%>`)"
                                        class="btn btn-outline-primary general-btn-Update btn-Update-<%= data[i]._id%>">Update</button>
                                    <button style="color: white;" type="button" onclick="clickSave(`<%= data[i]._id%>`)"
                                        class="btn btn-outline-success general-btn-Save btn-Save-<%= data[i]._id%>">Save</button>
                                    <button style="color: white;" type="button" onclick="clickDelete(`<%= data[i]._id%>`)"
                                        class="btn btn-outline-danger btn-Delete">Sa thải</button>
                                </td>
                            </tr>
                            <% }%>
                        </tbody>
                    </table>
                    <div class="container-fluid px-5">
                        <div class="row justify-content-end">
                            <button style="color: white;" type="button" id="btn-Back" class="btn btn-outline-dark">Back</button>
                            <button type="button" id="btn-Student" class="btn btn-outline-warning">To Student</button>
                            <button style="color: white;" type="button" id="btn-register" class="btn btn-outline-warning">Register</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-4">
                <div class="container">
                    <div class="stage">
                        <div class="campfire">
                            <div class="sparks">
                                <div class="spark"></div>
                                <div class="spark"></div>
                                <div class="spark"></div>
                                <div class="spark"></div>
                                <div class="spark"></div>
                                <div class="spark"></div>
                                <div class="spark"></div>
                                <div class="spark"></div>
                            </div>
                            <div class="logs">
                                <div class="log">
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                </div>
                                <div class="log">
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                </div>
                                <div class="log">
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                </div>
                                <div class="log">
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                </div>
                                <div class="log">
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                </div>
                                <div class="log">
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                </div>
                                <div class="log">
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                    <div class="streak"></div>
                                </div>
                            </div>
                            <div class="sticks">
                                <div class="stick"></div>
                                <div class="stick"></div>
                                <div class="stick"></div>
                                <div class="stick"></div>
                            </div>
                            <div class="fire">
                                <div class="fire__red">
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                </div>
                                <div class="fire__orange">
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                </div>
                                <div class="fire__yellow">
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                </div>
                                <div class="fire__white">
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                    <div class="flame"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
        </div>
    <div class="container">
        <button style="color: white" type="button" id="btn-Logout" class="btn btn-outline-danger">Logout</button>
    </div>
</body>
<script>
    function setCookie(name, value, days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + (value || "") + expires + "; path=/";
    }
    $("body").ready(function () {
        $(".general").css("display", "none");
        $(".general-btn-Save").css("display", "none");
        $.ajax({
            url: "/role",
            type: "GET"
        }).then(function (data) {
            if (data.data[0].role > 2) {
                $(".btn-Delete").css("display", "inline-block");
            } else {
                $(".just-role").css("display", "none");
                $(".general-btn-Update").css("display", "none");
                $(".btn-Delete").css("display", "none");
            }
            if (data.data[0].role == 2) {
                $("#btn-Back").click(function () {
                    window.location.href = "/login";
                })
            } else if (data.data[0].role == 3) {
                $("#btn-Back").click(function () {
                    window.location.href = "/manager";
                })
            }
        })
    })
    $("#btn-Student").click(function () {
        window.location.href = "/student";
    })
    function clickUpdate(id) {
        $(`.info-teacher-input-${id}`).css("display", "block");
        $(`.info-teacher-${id}`).css("display", "none");
        $(`.btn-Update-${id}`).css("display", "none");
        $(`.btn-Save-${id}`).css("display", "inline-block");
    }

    function clickSave(id) {
        var username = $(`.info-teacher-${id}`).html();
        var usernameChange = $(`#update-info-teacher-${id}`).val();
        $(`.info-teacher-input-${id}`).css("display", "none");
        $(`.info-teacher-${id}`).css("display", "block");
        $(`.btn-Update-${id}`).css("display", "inline-block");
        $(`.btn-Save-${id}`).css("display", "none");
        $.ajax({
            url: "/teacher",
            type: "PUT",
            data: {
                username: username,
                usernameChange: usernameChange
            }
        }).then(function (data) {
            window.location.reload();
        })
    }
    
    $("#btn-register").click(function(){
        window.location.href = "/register";
    })

    function clickDelete(id) {
        var template = `
        <div class="modal" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">Hỏi bạn...</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                    Có chắc muốn sa thải người thầy này???
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary btn-Cancel" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary btn-Sure">Sure</button>
                    </div>
                </div>
            </div>
        </div>
        `;
        $("body").append(template);
        $(".modal").css("display", "block");
        $(".close").click(function () {
            $(".modal").css("display", "none");
        })
        $(".btn-Cancel").click(function () {
            $(".modal").css("display", "none");
        })
        $(".btn-Sure").click(function () {
            var username = $(".info-teacher").html();
            $.ajax({
                url: "/teacher",
                type: "DELETE",
                data: {
                    username: username,
                }
            }).then(function (data) {
                $(".modal").css("display", "none");
                window.location.reload();
            })
        })
    }
    $("#btn-Logout").click(function () {
        var template = `
        <div class="modal" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 style="font-weight: bold; color: black" class="modal-title" id="exampleModalLabel">Hỏi bạn...</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body" style="font-weight: bold; color: black">
                    Có chắc muốn rời khỏi tài khoản???
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary btn-Cancel" data-dismiss="modal">Cancel</button>
                        <button type="button" class="btn btn-primary btn-Sure">Sure</button>
                    </div>
                </div>
            </div>
        </div>
        `;
        $("body").append(template);
        $(".modal").css("display", "block");
        $(".close").click(function () {
            $(".modal").css("display", "none");
        })
        $(".btn-Cancel").click(function () {
            $(".modal").css("display", "none");
        })
        $(".btn-Sure").click(function () {
            $.ajax({
                url: "/logout",
                type: "GET"
            }).then(function (data) {
                if(data){
                    setCookie("token", "", -1);
                    window.location.href = "/login"
                }else{
                    alert("Logout failed!!!");
                }
            })
        })
    })

</script>

</html>